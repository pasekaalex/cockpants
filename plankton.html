<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plankton Pac-Chomp | $COCKPANTS</title>
  <style>
    @font-face { font-family: 'Krabby Patty'; src: url('Krabby Patty.ttf') format('truetype'); }
    * { margin:0; padding:0; box-sizing:border-box; touch-action:manipulation; }
    body {
      font-family: 'Krabby Patty', Arial, sans-serif;
      background:#0a3a5c url('https://i.imgur.com/q8Qd5PK.jpeg') center/cover fixed;
      color:#ffeb3b; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;
      overflow:hidden; position:relative;
    }
    body::before { content:''; position:fixed; inset:0; background:rgba(0,20,40,0.6); z-index:0; }
    h1 { font-size:3.5rem; text-shadow:4px 4px #ff5722,0 0 30px #ffeb3b; margin:10px; z-index:1; }
    #board { font-size:18px; line-height:20px; background:#000; padding:20px; border:8px solid #ffcc00; border-radius:15px; box-shadow:0 0 40px #ffeb3b; z-index:1; }
    .ui { position:fixed; z-index:10; }
    .back-btn { top:20px; left:20px; padding:12px 20px; background:#8B4513; border:4px solid #ffcc00; border-radius:12px; color:#ffcc00; font-size:20px; text-decoration:none; }
    .score { top:20px; right:20px; font-size:24px; background:rgba(0,0,0,0.7); padding:8px 16px; border-radius:10px; }
    .lives { bottom:90px; left:50%; transform:translateX(-50%); font-size:28px; background:rgba(0,0,0,0.7); padding:8px 20px; border-radius:15px; }
    .music-toggle { bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:#8B4513; border:4px solid #ffcc00; color:#ffcc00; font-size:30px; cursor:pointer; }
    #dpad { position:fixed; bottom:20px; left:20px; display:none; }
    #dpad button { width:50px; height:50px; margin:5px; background:rgba(255,204,0,0.9); border:4px solid #ffeb3b; border-radius:50%; font-size:28px; }
    @media (max-width:768px) { #dpad { display:block; } .lives { bottom:180px; } }
  </style>
</head>
<body>
  <a href="index.html" class="ui back-btn">MENU</a>
  <div class="ui score">Score: <span id="score">0</span></div>
  <div class="ui lives">Lives: <span id="lives">3</span></div>
  <button class="ui music-toggle" id="musicToggle">ON</button>

  <div id="dpad">
    <button id="up">Up</button>
    <button id="left">Left</button>
    <button id="right">Right</button>
    <button id="down">Down</button>
  </div>

  <h1>PLANKTON PAC-CHOMP</h1>
  <pre id="board"></pre>

  <audio id="bgMusic" loop><source src="bob.mp3" type="audio/mpeg"></audio>

  <script>
    const ROWS = 31, COLS = 28;
    let board = Array(ROWS).fill().map(() => Array(COLS).fill(' '));
    let player = {r:23, c:14, dir:0};
    let ghosts = [
      {r:11, c:14, emoji:'Jellyfish', dir:0},
      {r:14, c:14, emoji:'Jellyfish', dir:0},
      {r:14, c:12, emoji:'Jellyfish', dir:0},
      {r:14, c:16, emoji:'Jellyfish', dir:0}
    ];
    let score = 0, lives = 3, power = 0;

    const maze = [
      "1111111111111111111111111111","1222222222221111222222222221","1211111221111111111121111121","1211111221111111111121111121",
      "1211111221111111111121111121","1222222222222222222222222221","1211111121111121111121111121","1211111121111121111121111121",
      "1222222222222222222222222221","1111111121111121111121111111","3000003121111121111121000003","3000003121111121111121000003",
      "3000003121111121111121000003","1111111122222222222121111111","3000003111111121111100000003","3000003111111121111100000003",
      "3000003111111121111100000003","1111111121111121111121111111","1222222222222222222222222221","1211111121111121111121111121",
      "1211111121111121111121111121","1222222222222222222222222221","1211111111111111111111111121","1211111111111111111111111121",
      "1222222111111111111111222221","1111112111222222221121111111","3000003111222222221100000003","3000003111222222221100000003",
      "1111112111222222221121111111","1222222222222222222222222221","1111111111111111111111111111"
    ];

    // Load maze
    for(let r=0; r<ROWS; r++) for(let c=0; c<COLS; c++) {
      const v = maze[r][c];
      board[r][c] = v==='1'?'Wall':v==='2'?'Bubble':v==='3'?' ':v==='0'?'Dot':'Krabby Patty';
    }
    board[player.r][player.c] = 'Crab';

    function render() {
      document.getElementById('board').textContent = board.map(row=>row.join('')).join('\n');
      document.getElementById('score').textContent = score;
      document.getElementById('lives').textContent = lives + " x Mr. Krabs";
    }

    function movePlayer() {
      const dirs = [[0,-1],[1,0],[0,1],[-1,0]]; // U R D L
      const [dr,dc] = dirs[player.dir];
      const nr = player.r + dr, nc = player.c + dc;
      if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS && board[nr][nc]!=='Wall') {
        board[player.r][player.c] = ' ';
        player.r = nr; player.c = nc;
        if(board[nr][nc]==='Dot') { score+=10; board[nr][nc]=' '; }
        if(board[nr][nc]==='Bubble') { score+=50; power=100; board[nr][nc]=' '; }
      }
      board[player.r][player.c] = 'Crab';
    }

    function moveGhosts() {
      ghosts.forEach(g => {
        const dirs = [[-1,0],[0,1],[1,0],[0,-1]];
        let moved = false;
        while(!moved) {
          const [dr,dc] = dirs[Math.floor(Math.random()*4)];
          const nr = g.r + dr, nc = g.c + dc;
          if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS && board[nr][nc]!=='Wall' && board[nr][nc]!=='Jellyfish') {
            board[g.r][g.c] = ' ';
            g.r = nr; g.c = nc;
            board[g.r][g.c] = 'Jellyfish';
            moved = true;
          }
        }
        if(g.r===player.r && g.c===player.c) {
          if(power>0) { score+=200; g.r=14; g.c=14; board[g.r][g.c]='Jellyfish'; }
          else { lives--; if(lives<=0) alert("GAME OVER! Score: "+score); location.reload(); }
        }
      });
      if(power>0) power--;
    }

    document.addEventListener('keydown', e => {
      const map = {ArrowUp:0, w:0, W:0, ArrowRight:1, d:1, D:1, ArrowDown:2, s:2, S:2, ArrowLeft:3, a:3, A:3};
      if(map[e.key]!==undefined) player.dir = map[e.key];
    });

    ["up","left","right","down"].forEach((id,i) => {
      document.getElementById(id).ontouchstart = e => { e.preventDefault(); player.dir = [0,3,1,2][i]; };
    });

    const music = document.getElementById("bgMusic"); music.volume=0.3;
    document.getElementById("musicToggle").onclick = () => {
      music.paused ? music.play() : music.pause();
      document.getElementById("musicToggle").textContent = music.paused ? "OFF" : "ON";
    };
    document.addEventListener("click",()=>music.play().catch(()=>{}),{once:true});

    setInterval(() => { movePlayer(); moveGhosts(); render(); }, 200);
    render();
  </script>
</body>
</html>
