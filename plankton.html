<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plankton Pac-Chomp | $COCKPANTS Games</title>
  <style>
    @font-face { font-family: 'Krabby Patty'; src: url('Krabby Patty.ttf') format('truetype'); }
    * { margin:0; padding:0; box-sizing:border-box; touch-action:manipulation; }
    body {
      font-family: 'Krabby Patty', Arial, sans-serif;
      background: #0a3a5c url('https://i.imgur.com/q8Qd5PK.jpeg') center/cover fixed;
      color: #ffeb3b; text-align:center; min-height:100vh;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      overflow:hidden; position:relative;
    }
    body::before { content:''; position:fixed; inset:0; background:rgba(0,20,40,0.5); z-index:0; }
    h1 { font-size:3rem; text-shadow:4px 4px #ff5722, 0 0 30px #ffeb3b; margin:10px; z-index:1; }
    canvas { border:8px solid #ffcc00; border-radius:15px; box-shadow:0 0 40px #ffeb3b; z-index:1; image-rendering:pixelated; }
    .ui { position:fixed; z-index:10; }
    .back-btn { top:20px; left:20px; padding:12px 20px; background:#8B4513; border:4px solid #ffcc00; border-radius:12px; color:#ffcc00; font-size:20px; text-decoration:none; }
    .score { top:20px; right:20px; font-size:24px; text-shadow:2px 2px #000; background:rgba(0,0,0,0.5); padding:5px 15px; border-radius:10px; }
    .lives { bottom:90px; left:50%; transform:translateX(-50%); font-size:28px; background:rgba(0,0,0,0.5); padding:5px 20px; border-radius:15px; }
    .music-toggle { bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:#8B4513; border:4px solid #ffcc00; color:#ffcc00; font-size:30px; cursor:pointer; }

    /* Mobile D-pad */
    #dpad { position:fixed; bottom:20px; left:20px; width:140px; height:140px; z-index:100; display:none; }
    #dpad button { position:absolute; width:50px; height:50px; background:rgba(255,204,0,0.8); border:4px solid #ffeb3b; border-radius:50%; color:#000; font-size:28px; font-weight:bold; }
    #up    { top:0; left:50%; transform:translateX(-50%); }
    #left  { left:0; top:50%; transform:translateY(-50%); }
    #right { right:0; top:50%; transform:translateY(-50%); }
    #down  { bottom:0; left:50%; transform:translateX(-50%); }
    @media (max-width:768px) { #dpad { display:block; } .lives { bottom:180px; } }
  </style>
</head>
<body>
  <a href="index.html" class="ui back-btn">MENU</a>
  <div class="ui score">Score: <span id="score">0</span></div>
  <div class="ui lives">Lives: <span id="lives">3</span></div>
  <button class="ui music-toggle" id="musicToggle">ON</button>

  <div id="dpad">
    <button id="up">↑</button>
    <button id="left">←</button>
    <button id="right">→</button>
    <button id="down">↓</button>
  </div>

  <h1>PLANKTON PAC-CHOMP</h1>
  <canvas id="game" width="560" height="620"></canvas>

  <audio id="bgMusic" loop preload="auto">
    <source src="bob.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const TILE = 20;
    const ROWS = 31, COLS = 28;

    // Same maze as before (shortened for brevity – full maze stays the same)
    const maze = [ /* ... your full maze from previous version ... */ ]
      .map(row => row.split('').map(Number));

    // Player & ghosts setup (same as before)
    let player = { x:14*TILE, y:23*TILE, dir:0, nextDir:0, speed:2, mouth:0 };
    const dirs = [[-1,0],[0,-1],[1,0],[0,1]]; // L U R D
    const ghosts = [ /* same ghost setup */ ];
    let score = 0, lives = 3, dotsLeft = 0, frightenedTimer = 0, globalTimer = 0;

    // Count dots
    for(let y=0; y<ROWS; y++) for(let x=0; x<COLS; x++)
      if(maze[y][x]===0 || maze[y][x]===2) dotsLeft++;

    // ─────────────────────────────────────
    // CONTROLS – WASD + Arrows + Mobile D-pad
    // ─────────────────────────────────────
    const keys = {};
    window.addEventListener('keydown', e => {
      if('ArrowLeft,ArrowUp,ArrowRight,ArrowDown,a,w,s,d,A,W,S,D'.includes(e.key)) {
        e.preventDefault();
        const map = { 'ArrowLeft':0, 'a':0, 'A':0,
                      'ArrowUp':1,    'w':1, 'W':1,
                      'ArrowRight':2, 'd':2, 'D':2,
                      'ArrowDown':3,  's':3, 'S':3 };
        player.nextDir = map[e.key];
      }
    });

    // Mobile D-pad
    document.getElementById('up').ontouchstart = e => { e.preventDefault(); player.nextDir = 1; };
    document.getElementById('left').ontouchstart = e => { e.preventDefault(); player.nextDir = 0; };
    document.getElementById('right').ontouchstart = e => { e.preventDefault(); player.nextDir = 2; };
    document.getElementById('down').ontouchstart = e => { e.preventDefault(); player.nextDir = 3; };

    // (Same game logic as previous version – drawMaze, drawPlayer, ghost AI, etc.)
    // ... [All the functions from the previous working version go here] ...

    // Music toggle (same)
    const music = document.getElementById('bgMusic');
    music.volume = 0.3;
    document.getElementById('musicToggle').onclick = () => {
      if(music.paused) { music.play(); document.getElementById('musicToggle').textContent = "ON"; }
      else { music.pause(); document.getElementById('musicToggle').textContent = "OFF"; }
    };
    document.addEventListener('click', () => music.play().catch(()=>{}), {once:true});

    // Start the game
    function loop() {
      update(); render(); requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
