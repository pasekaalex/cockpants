<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Plankton Pac-Chomp | $COCKPANTS</title>
<style>
@font-face{font-family:'Krabby Patty';src:url('Krabby Patty.ttf')format('truetype');font-display:swap}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Krabby Patty',Arial,sans-serif;
  min-height:100vh;background:#0a3a5c url('https://i.imgur.com/q8Qd5PK.jpeg') center/cover fixed;
  color:#ffeb3b;display:flex;flex-direction:column;align-items:center;padding:18px;overflow-x:hidden;
}
body::before{content:'';position:fixed;inset:0;background:rgba(0,20,40,0.5);z-index:0}
header{width:100%;max-width:980px;display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;z-index:5}
.title{font-size:20px;display:flex;align-items:center;gap:12px;text-shadow:4px 4px 0 #8B4513,0 0 30px #ffeb3b}
.btn{
  background:linear-gradient(135deg,rgba(139,69,19,.95),rgba(101,67,33,.95));
  border:4px solid #ffcc00;color:#ffcc00;padding:8px 14px;border-radius:10px;
  font-family:inherit;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:6px;
}
.small{font-size:14px;padding:6px 10px}
.big-btn{background:linear-gradient(135deg,#4CAF50,#2E7D32);color:#fff;border:3px solid #8BC34A;
  padding:12px 20px;border-radius:12px;font-size:17px}
main{width:100%;max-width:980px;display:flex;gap:20px;align-items:flex-start;z-index:5}
#canvas-wrap{background:rgba(0,0,0,0.2);padding:12px;border-radius:14px;border:4px solid rgba(255,235,59,0.1);box-shadow:0 12px 40px rgba(0,0,0,0.6)}
canvas{display:block;background:#000;border:8px solid #ffcc00;border-radius:15px;box-shadow:0 0 40px #ffeb3b;image-rendering:pixelated}
.hud{width:260px;display:flex;flex-direction:column;gap:12px}
.stat{background:#06283b;border:3px solid #ffcc00;border-radius:12px;padding:14px;color:#fff}
.stat small{display:block;color:#cfe9ff;font-size:12px;margin-top:4px}
.dpad{
  position:fixed;right:12px;bottom:12px;width:150px;height:150px;display:grid;grid-template:repeat(3,1fr)/repeat(3,1fr);gap:8px;z-index:50
}
.dpad button{background:#ffef9c;border:none;border-radius:12px;font-size:22px;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
.dpad .blank{background:transparent;box-shadow:none;pointer-events:none}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;justify-content:center;align-items:center;z-index:999}
.modal{background:linear-gradient(180deg,#8B4513,#552B12);border:4px solid #ffcc00;padding:30px;border-radius:16px;color:#fff;width:340px;text-align:center}
@media(max-width:920px){
  main{flex-direction:column;align-items:center}
  .hud{width:92vw;max-width:420px}
  canvas{width:92vw;height:auto}
}
</style>
</head>
<body>
<header>
  <div style="display:flex;gap:12px;align-items:center">
    <a href="index.html" class="btn">Back to MENU</a>
    <div class="title">Plankton Pac-Chomp <span style="font-size:12px;color:#cfe9ff">— Bikini Bottom Arcade</span></div>
  </div>
  <div style="display:flex;gap:8px">
    <button id="startBtn" class="big-btn">Start Game</button>
    <button id="pauseBtn" class="btn small">Pause</button>
    <button id="restartBtn" class="btn small">Restart</button>
    <button id="musicToggle" class="btn small">Music On</button>
  </div>
</header>

<main>
  <div id="canvas-wrap">
    <canvas id="game"></canvas>
    <div style="text-align:center;margin-top:8px;color:#cfe9ff;font-size:13px">Bubbles = pellets • Krabby Patties = power pellets</div>
  </div>
  <aside class="hud">
    <div class="stat">Score: <strong id="score">0</strong><small>Eat bubbles</small></div>
    <div class="stat">Lives: <strong id="lives">3</strong><small>Avoid jellyfish</small></div>
    <div class="stat">Mode: <strong id="mode">ready</strong></div>
  </aside>
</main>

<div class="dpad">
  <div class="blank"></div><button data-dir="up">Up Arrow</button><div class="blank"></div>
  <button data-dir="left">Left Arrow</button><div class="blank"></div><button data-dir="right">Right Arrow</button>
  <div class="blank"></div><button data-dir="down">Down Arrow</button><div class="blank"></div>
</div>

<audio id="bgMusic" loop preload="auto"><source src="bob.mp3" type="audio/mpeg"></audio>

<div id="modal" class="modal-backdrop" style="display:none">
  <div class="modal">
    <h2 id="title">Game Over</h2>
    <p>Your score: <strong id="finalScore">0</strong></p>
    <div style="margin-top:20px;display:flex;gap:12px;justify-content:center">
      <button id="modalRestart" class="btn">Play Again</button>
      <a href="index.html" class="btn">Menu</a>
    </div>
  </div>
</div>

<script>
// ─────────────────────────────────────────────────────────────────────────────
// Plankton Pac-Chomp – fixed & polished version (2025 $COCKPANTS edition)
// ─────────────────────────────────────────────────────────────────────────────
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d',{alpha:false});
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const modeEl = document.getElementById('mode');

// 28×31 classic layout – fully enclosed & symmetrical
const map = [
"############################",
"#............##............#",
"#.####.#####..#####.####.#",
"#o####.#####..#####.####o#",
"#.####.#####..#####.####.#",
"#..........................#",
"#.####.#.##########.#.####.#",
"#......#.....##.....#......#",
"######.#####..#####.######",
"#......##..........##......#",
"#.####.##.####..####.##.####.#",
"#o.....##....##....##.....o#",
"######.##.##..##.##.##.######",
"#.........##..##.........#",
"######.##.######.##.######",
"#......##.........##......#",
"#.####.############.####.#",
"#....#....##..##....#....#",
"####.##..####..####..##.####",
"#......#..........#......#",
"#.####.####..####.####.####.#",
"#o####................####o#",
"####.##.####..####.##.####",
"#.........##..##.........#",
"#.####.##.########.##.####.#",
"#......##....P.....##......#",
"#.####.##.########.##.####.#",
"#....#....##..##....#....#",
"#.##########..##########.#",
"#..........................#",
"############################"
];

const TILE = 20;
canvas.width = 28*TILE;
canvas.height = 31*TILE;

// perfect 1:1 scaling
canvas.style.width = canvas.width + 'px';
canvas.style.height = canvas.height + 'px';

let score = 0, lives = 3, pelletsLeft = 0, powerTimer = 0, readyTimer = 120;
let player = {x:13.5, y:23.5, dir:{x:0,y:0}, nextDir:{x:0,y:0}, speed:0.165};
const ghosts = [
  {x:13.5,y:11.5,color:'#FF5555',dir:{x:0,y:0},frightened:false,flash:false}, // red
  {x:13.5,y:14.5,color:'#55FFFF',dir:{x:0,y:0},frightened:false,flash:false}, // cyan
  {x:11.5,y:14.5,color:'#FFB852',dir:{x:0,y:0},frightened:false,flash:false}, // orange
  {x:15.5,y:14.5,color:'#FF55FF',dir:{x:0,y:0},frightened:false,flash:false}  // pink
];

function resetGame(full=true){
  score = full?0:score; lives = full?3:lives;
  player.x=13.5; player.y=23.5; player.dir={x:0,y:0}; player.nextDir={x:0,y:0};
  ghosts.forEach((g,i)=>{g.x=[13.5,13.5,11.5,15.5][i]; g.y=11.5+i*3; g.dir={x:0,y:0}; g.frightened=false;});
  pelletsLeft = 0;
  for(let y=0;y<map.length;y++)for(let x=0;x<map[y].length;x++){
    if(map[y][x]==='.'||map[y][x]==='o') pelletsLeft++;
  }
  readyTimer = 150;
  scoreEl.textContent=score; livesEl.textContent=lives;
}
resetGame();

function isWall(x,y){return map[Math.round(y)]?.[Math.round(x)]==='#'}

document.getElementById('startBtn').onclick=()=>{if(readyTimer<=0)readyTimer=1;};
document.getElementById('pauseBtn').onclick=()=>{paused=!paused; document.getElementById('pauseBtn').textContent=paused?'Resume':'Pause';};
document.getElementById('restartBtn').onclick=()=>{resetGame();paused=false;document.getElementById('pauseBtn').textContent='Pause';};
document.getElementById('modalRestart').onclick=()=>{document.getElementById('modal').style.display='none';resetGame();paused=false;};

const keys={ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},
            a:{x:-1,y:0},d:{x:1,y:0},w:{x:0,y:-1},s:{x:0,y:1}};
addEventListener('keydown',e=>{if(keys[e.key])player.nextDir=keys[e.key];});

document.querySelectorAll('[data-dir]').forEach(b=>{
  const d={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[b.dataset.dir];
  ['touchstart','mousedown'].forEach(ev=>b.addEventListener(ev,()=>{player.nextDir=d;},{passive:false}));
});

const music=document.getElementById('bgMusic');music.volume=0.3;
document.addEventListener('click',()=>music.play(),{once:true});
document.getElementById('musicToggle').onclick=()=>{
  if(music.paused)music.play();else music.pause();
  document.getElementById('musicToggle').textContent=music.paused?'Music Off':'Music On';
};

function update(){
  if(paused||readyTimer>0) return;

  // player direction logic
  if(player.nextDir.x || player.nextDir.y){
    const nx=player.x+player.nextDir.x, ny=player.y+player.nextDir.y;
    if(!isWall(nx,ny)) player.dir = player.nextDir;
  }
  const nx=player.x+player.dir.x*player.speed, ny=player.y+player.dir.y*player.speed;
  if(!isWall(nx,ny)){player.x=nx; player.y=ny;} 

  // eat pellets
  const tx=Math.round(player.x), ty=Math.round(player.y);
  if(map[ty]?.[tx]==='.'){map[ty][tx]=' ';score+=10;pelletsLeft--;scoreEl.textContent=score;}
  if(map[ty]?.[tx]==='o'){map[ty][tx]=' ';score+=50;pelletsLeft--;powerTimer=540;
    ghosts.forEach(g=>g.frightened=true);scoreEl.textContent=score;}

  if(powerTimer>0){powerTimer--; if(powerTimer===0)ghosts.forEach(g=>g.frightened=false);}

  // ghost AI & movement
  ghosts.forEach(g=>{
    if(Math.random()<0.04){ // reduced BFS spam
      const dirs=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}].filter(d=>!isWall(g.x+d.x,g.y+d.y));
      if(dirs.length) g.dir = g.frightened ? dirs[Math.floor(Math.random()*dirs.length)] : dirs.reduce((best,d)=> {
        const dist=(g.x+d.x-player.x)**2+(g.y+d.y-player.y)**2;
        return !best||dist<best.dist ? {dir:d,dist} : best;
      },null).dir;
    }
    const speed = g.frightened?0.08:0.125;
    const gx=g.x+g.dir.x*speed, gy=g.y+g.dir.y*speed;
    if(!isWall(gx,gy)){g.x=gx; g.y=gy;}
  });

  // collision
  for(let g of ghosts){
    if(Math.hypot(g.x-player.x,g.y-player.y)<0.6){
      if(g.frightened){score+=200; g.x=13.5; g.y=14.5;}
      else{
        lives--; livesEl.textContent=lives;
        if(lives<=0){document.getElementById('modal').style.display='flex';
          document.getElementById('title').textContent='Game Over';
          document.getElementById('finalScore').textContent=score;}
        else resetGame(false);
        return;
      }
    }
  }

  if(pelletsLeft===0){
    document.getElementById('modal').style.display='flex';
    document.getElementById('title').textContent='YOU WIN!';
    document.getElementById('finalScore').textContent=score;
  }
}

function draw(){
  ctx.fillStyle='#021827'; ctx.fillRect(0,0,canvas.width,canvas.height);

  // walls – coral style
  for(let y=0;y<map.length;y++)for(let x=0;x<map[y].length;x++){
    if(map[y][x]==='#'){
      ctx.fillStyle='#ff69b4';
      ctx.fillRect(x*TILE+2,y*TILE+2,TILE-4,TILE-4);
      ctx.fillStyle='#ff1493';
      ctx.fillRect(x*TILE+5,y*TILE+5,TILE-10,TILE-10);
    }
    else if(map[y][x]==='.'){
      ctx.fillStyle='#ffffff';
      ctx.beginPath();ctx.arc(x*TILE+TILE/2,y*TILE+TILE/2,3,0,Math.PI*2);ctx.fill();
    }
    else if(map[y][x]==='o'){
      ctx.fillStyle='#ffd700';
      ctx.beginPath();ctx.arc(x*TILE+TILE/2,y*TILE+TILE/2,7,0,Math.PI*2);ctx.fill();
    }
  }

  // READY!
  if(readyTimer>0){
    ctx.font='48px "Krabby Patty"';
    ctx.fillStyle='#ffcc00'; ctx.strokeStyle='#000'; ctx.lineWidth=6;
    ctx.strokeText('READY!',canvas.width/2-100,canvas.height/2+16);
    ctx.fillText('READY!',canvas.width/2-100,canvas.height/2+16);
    readyTimer--;
  }

  // player – Plankton (crab emoji)
  ctx.font = (TILE*1.8)+'px serif';
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText('Crab',player.x*TILE,player.y*TILE);

  // ghosts – jellyfish with flashing when frightened
  ghosts.forEach(g=>{
    ctx.font = (TILE*1.6)+'px serif';
    ctx.fillStyle = g.frightened && Math.floor(performance.now()/100)%2 ? '#2244ff' : g.color;
    ctx.fillText('Jellyfish',(g.x)*TILE,(g.y)*TILE);
  });
}

(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
