<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Whack-a-Bulk | $COCKPANTS</title>
  <meta name="x-ogp-key" content="a570f587-c883-4235-ac69-14eef9cfd6e2" id="ogp-key-meta">
  <script src="https://sdk.play.fun"></script>
  <style>
    @font-face {
      font-family: 'Krabby Patty';
      src: url('https://cockpants.lol/Krabby%20Patty.ttf') format('truetype');
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Krabby Patty', Arial, sans-serif;
      min-height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* Farm Background with Sky */
    .game-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: 
        url('https://bulked.lol/images/sky3.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }

    /* Sun */
    .sun {
      position: fixed;
      top: 3%;
      right: 8%;
      width: clamp(60px, 12vw, 100px);
      height: clamp(60px, 12vw, 100px);
      background: radial-gradient(circle, #FFE135 0%, #FFD700 50%, #FFA500 100%);
      border-radius: 50%;
      box-shadow: 
        0 0 40px #FFD700,
        0 0 80px rgba(255, 215, 0, 0.5);
      z-index: 1;
      animation: sunPulse 4s ease-in-out infinite;
    }

    @keyframes sunPulse {
      0%, 100% { box-shadow: 0 0 40px #FFD700, 0 0 80px rgba(255, 215, 0, 0.5); }
      50% { box-shadow: 0 0 60px #FFD700, 0 0 100px rgba(255, 215, 0, 0.7); }
    }

    /* Clouds */
    .cloud {
      position: fixed;
      background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%);
      border-radius: 50px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      animation: floatCloud linear infinite;
      z-index: 2;
    }

    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: inherit;
      border-radius: 50%;
    }

    .cloud-1 { width: 120px; height: 45px; top: 8%; animation-duration: 30s; }
    .cloud-1::before { width: 55px; height: 55px; top: -28px; left: 20px; }
    .cloud-1::after { width: 40px; height: 40px; top: -18px; left: 60px; }

    .cloud-2 { width: 90px; height: 35px; top: 18%; animation-duration: 40s; animation-delay: -15s; }
    .cloud-2::before { width: 45px; height: 45px; top: -22px; left: 12px; }
    .cloud-2::after { width: 30px; height: 30px; top: -12px; left: 45px; }

    .cloud-3 { width: 70px; height: 28px; top: 12%; left: 25%; animation-duration: 35s; animation-delay: -5s; }
    .cloud-3::before { width: 35px; height: 35px; top: -18px; left: 8px; }
    .cloud-3::after { width: 25px; height: 25px; top: -10px; left: 32px; }

    @keyframes floatCloud {
      from { transform: translateX(-150px); }
      to { transform: translateX(calc(100vw + 150px)); }
    }

    /* Rolling Hills */
    .hills {
      position: fixed;
      bottom: 20%;
      left: 0;
      right: 0;
      height: 25%;
      z-index: 1;
    }

    .hill {
      position: absolute;
      border-radius: 50% 50% 0 0;
    }

    .hill-1 {
      width: 60%;
      height: 100%;
      background: linear-gradient(180deg, #3CB371 0%, #228B22 100%);
      left: -10%;
    }

    .hill-2 {
      width: 70%;
      height: 80%;
      background: linear-gradient(180deg, #2E8B57 0%, #1E6B1E 100%);
      right: -15%;
    }

    /* Barn */
    .barn {
      position: fixed;
      top: 8%;
      left: 5%;
      width: clamp(100px, 20vw, 180px);
      z-index: 3;
      filter: drop-shadow(5px 5px 8px rgba(0,0,0,0.6));
    }

    .barn svg {
      width: 100%;
      height: auto;
    }

    /* Silo */
    .silo {
      position: fixed;
      top: 12%;
      left: calc(5% + clamp(100px, 20vw, 180px) + 10px);
      width: clamp(40px, 8vw, 60px);
      z-index: 3;
    }

    .silo svg {
      width: 100%;
      height: auto;
      filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
    }

    /* Farmhouse */
    .farmhouse {
      position: fixed;
      top: 10%;
      right: 5%;
      width: clamp(80px, 15vw, 140px);
      z-index: 3;
      filter: drop-shadow(4px 4px 6px rgba(0,0,0,0.5));
    }

    .farmhouse svg {
      width: 100%;
      height: auto;
    }

    /* Hay bales */
    .hay {
      position: fixed;
      z-index: 3;
    }

    .hay-1 { bottom: 8%; left: 3%; width: clamp(50px, 10vw, 80px); }
    .hay-2 { bottom: 6%; left: 10%; width: clamp(40px, 8vw, 60px); transform: rotate(-5deg); }
    .hay-3 { bottom: 8%; right: 8%; width: clamp(55px, 11vw, 85px); transform: scaleX(-1); }
    .hay-4 { bottom: 5%; right: 15%; width: clamp(35px, 7vw, 50px); transform: scaleX(-1) rotate(3deg); }

    .hay svg {
      width: 100%;
      height: auto;
      filter: drop-shadow(3px 3px 4px rgba(0,0,0,0.4));
    }

    /* Fence */
    .fence {
      position: fixed;
      bottom: 18%;
      left: 0;
      right: 0;
      height: 25px;
      z-index: 4;
    }

    .fence::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 6px;
      background: repeating-linear-gradient(
        90deg,
        #8B4513 0px,
        #8B4513 15px,
        #A0522D 15px,
        #A0522D 30px
      );
    }

    .fence::after {
      content: '';
      position: absolute;
      top: 20%;
      left: 0;
      right: 0;
      height: 6px;
      background: repeating-linear-gradient(
        90deg,
        #8B4513 0px,
        #8B4513 15px,
        #A0522D 15px,
        #A0522D 30px
      );
    }

    .fence-post {
      position: absolute;
      top: 0;
      width: 12px;
      height: 100%;
      background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
    }

    /* Ground */
    .ground {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 20%;
      background: linear-gradient(180deg, #228B22 0%, #145214 50%, #0d3d0d 100%);
      z-index: 2;
    }

    /* Grass tufts */
    .grass {
      position: fixed;
      bottom: 18%;
      z-index: 3;
    }

    .grass svg {
      width: 30px;
      height: 20px;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #8B4513 0%, #654321 50%, #4a3020 100%);
      border: 5px solid #FFD700;
      border-radius: 0 0 30px 30px;
      padding: 12px 25px;
      text-align: center;
      box-shadow: 
        0 8px 30px rgba(0,0,0,0.6),
        inset 0 -3px 10px rgba(0,0,0,0.3);
      z-index: 100;
      position: relative;
      margin: 0 10%;
    }

    .title {
      font-size: clamp(24px, 8vw, 42px);
      color: #FFD700;
      text-shadow: 3px 3px 0 #8B4513, 4px 4px 10px rgba(0,0,0,0.5);
    }

    .stats {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .stat {
      background: rgba(0,0,0,0.7);
      border: 3px solid;
      border-radius: 15px;
      padding: 8px 15px;
      color: white;
      font-size: clamp(12px, 3.5vw, 18px);
    }

    .stat.score { border-color: #FF6B6B; color: #FF6B6B; box-shadow: 0 0 10px rgba(255,107,107,0.3); }
    .stat.time { border-color: #4ECDC4; color: #4ECDC4; box-shadow: 0 0 10px rgba(78,205,196,0.3); }
    .stat.high { border-color: #FFD700; color: #FFD700; box-shadow: 0 0 10px rgba(255,215,0,0.3); }

    /* Fence */
      position: fixed;
      bottom: 22%;
      left: 0;
      right: 0;
      height: 30px;
      background: repeating-linear-gradient(
        90deg,
        #8B4513 0px,
        #8B4513 10px,
        #A0522D 10px,
        #A0522D 20px
      );
      z-index: 4;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    /* Ground */
    .ground {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 25%;
      background: linear-gradient(180deg, #228B22 0%, #006400 50%, #004d00 100%);
      z-index: 2;
    }

    /* Game Area */
    .game-area {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      padding: 20px;
      padding-bottom: 30%;
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      z-index: 10;
      position: relative;
    }

    /* Dirt Mounds */
    .hole {
      aspect-ratio: 1.2;
      background: radial-gradient(ellipse at center, #5c4033 0%, #3d2817 60%, #1a0f08 100%);
      border: 4px solid #8B4513;
      border-radius: 50%;
      position: relative;
      overflow: visible;
      cursor: pointer;
      box-shadow: 
        inset 0 15px 25px rgba(0,0,0,0.8),
        0 8px 15px rgba(0,0,0,0.4),
        0 0 0 3px #654321;
    }

    .hole::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      border: 3px dashed rgba(139, 69, 19, 0.5);
      border-radius: 50%;
      animation: rotateHint 10s linear infinite;
    }

    @keyframes rotateHint {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .hole::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 5%;
      right: 5%;
      height: 30%;
      background: linear-gradient(to top, #2d1a0f, #4a3728);
      border-radius: 0 0 50% 50%;
      z-index: 1;
    }

    .bulk {
      position: absolute;
      bottom: -10%;
      left: 50%;
      transform: translateX(-50%) scaleY(0);
      width: 90%;
      height: 90%;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom center;
      transition: transform 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none;
      z-index: 2;
    }

    .hole.up .bulk {
      transform: translateX(-50%) scaleY(1);
    }

    .hole.whacked .bulk {
      transform: translateX(-50%) scaleY(0.8) rotate(15deg);
      filter: brightness(1.5) saturate(0.5);
    }

    /* Dirt particles */
    .dirt {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #8B4513;
      border-radius: 50%;
      animation: dirtFly 0.4s ease-out forwards;
      z-index: 5;
    }

    @keyframes dirtFly {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
    }

    /* Score popup */
    .score-popup {
      position: absolute;
      font-size: clamp(24px, 8vw, 40px);
      font-weight: bold;
      color: #FFD700;
      text-shadow: 3px 3px 0 #8B0000, 0 0 20px #FFD700;
      animation: scorePop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      pointer-events: none;
      z-index: 20;
    }

    @keyframes scorePop {
      0% { transform: translate(-50%, 0) scale(0.5); opacity: 0; }
      50% { transform: translate(-50%, -30px) scale(1.3); opacity: 1; }
      100% { transform: translate(-50%, -60px) scale(1); opacity: 0; }
    }

    /* Screens */
    .start-screen, .game-over-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(30,60,30,0.95) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
      text-align: center;
    }

    .hidden { display: none !important; }

    .screen-title {
      font-size: clamp(36px, 12vw, 64px);
      color: #FFD700;
      text-shadow: 4px 4px 0 #8B4513, 6px 6px 20px rgba(0,0,0,0.8);
      margin-bottom: 10px;
      animation: titleBounce 1s ease-in-out infinite;
    }

    @keyframes titleBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .screen-subtitle {
      font-size: clamp(16px, 5vw, 28px);
      color: #90EE90;
      margin-bottom: 25px;
    }

    .instructions {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      max-width: 400px;
    }

    .instructions p {
      color: #ccc;
      font-size: clamp(12px, 4vw, 18px);
      margin: 10px 0;
    }

    .btn {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      border: 5px solid #FF8C00;
      color: #000;
      font-family: 'Krabby Patty', Arial, sans-serif;
      font-size: clamp(24px, 7vw, 36px);
      padding: 18px 60px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 10px 30px rgba(255,165,0,0.5), inset 0 -3px 0 rgba(0,0,0,0.2);
      text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
    }

    .btn:hover {
      transform: scale(1.1) translateY(-3px);
      box-shadow: 0 15px 40px rgba(255,165,0,0.7), inset 0 -3px 0 rgba(0,0,0,0.2);
    }

    .btn:active {
      transform: scale(1.05) translateY(0);
    }

    .difficulty-select {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .diff-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: 3px solid #fff;
      color: white;
      font-family: 'Krabby Patty', Arial, sans-serif;
      font-size: clamp(14px, 4vw, 20px);
      padding: 12px 25px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .diff-btn:hover, .diff-btn.selected {
      transform: scale(1.15);
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      box-shadow: 0 0 20px rgba(255,215,0,0.6);
    }

    .final-score {
      font-size: clamp(60px, 18vw, 100px);
      color: #FF6B6B;
      text-shadow: 5px 5px 0 #8B0000, 0 0 30px rgba(255,107,107,0.5);
      margin: 15px 0;
      animation: scorePulse 0.5s ease-in-out infinite alternate;
    }

    @keyframes scorePulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }

    .new-high {
      font-size: clamp(24px, 7vw, 40px);
      color: #FFD700;
      text-shadow: 0 0 20px #FFD700;
      animation: glow 0.5s ease-in-out infinite alternate;
      margin-bottom: 20px;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #FFD700; }
      to { text-shadow: 0 0 30px #FFD700, 0 0 50px #FFA500; }
    }

    /* Combo indicator */
    .combo {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(40px, 15vw, 80px);
      color: #FF6B6B;
      text-shadow: 4px 4px 0 #8B0000;
      animation: comboShow 0.5s ease-out forwards;
      z-index: 50;
      pointer-events: none;
      opacity: 0;
    }

    @keyframes comboShow {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
    }
  </style>
</head>
<body>
  <!-- Sun -->
  <div class="sun"></div>

  <!-- Clouds -->
  <div class="cloud cloud-1"></div>
  <div class="cloud cloud-2"></div>
  <div class="cloud cloud-3"></div>

  <!-- Rolling Hills Background -->
  <div class="hills">
    <div class="hill hill-1"></div>
    <div class="hill hill-2"></div>
  </div>

  <!-- Barn with Silo -->
  <div class="barn">
    <svg viewBox="0 0 100 90" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Main barn -->
      <path d="M50 5 L98 40 L98 85 L2 85 L2 40 Z" fill="#B22222"/>
      <path d="M50 5 L98 40 L2 40 Z" fill="#CD5C5C"/>
      <!-- Roof stripe -->
      <path d="M30 40 L50 15 L70 40" fill="#8B0000"/>
      <!-- Door -->
      <rect x="35" y="50" width="30" height="35" rx="3" fill="#4a3728" stroke="#2d1a0f" stroke-width="2"/>
      <circle cx="50" cy="67" r="3" fill="#FFD700"/>
      <!-- Windows -->
      <rect x="12" y="25" width="18" height="18" fill="#87CEEB" stroke="#4a3020" stroke-width="2"/>
      <rect x="70" y="25" width="18" height="18" fill="#87CEEB" stroke="#4a3020" stroke-width="2"/>
      <!-- X on windows -->
      <line x1="12" y1="25" x2="30" y2="43" stroke="#4a3020" stroke-width="2"/>
      <line x1="30" y1="25" x2="12" y2="43" stroke="#4a3020" stroke-width="2"/>
      <line x1="70" y1="25" x2="88" y2="43" stroke="#4a3020" stroke-width="2"/>
      <line x1="88" y1="25" x2="70" y2="43" stroke="#4a3020" stroke-width="2"/>
    </svg>
  </div>

  <!-- Silo -->
  <div class="silo">
    <svg viewBox="0 0 40 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="20" cy="95" rx="18" ry="5" fill="#696969"/>
      <rect x="2" y="5" width="36" height="90" fill="#A9A9A9"/>
      <ellipse cx="20" cy="5" rx="18" ry="5" fill="#BEBEBE"/>
      <line x1="5" y1="20" x2="35" y2="20" stroke="#808080" stroke-width="1"/>
      <line x1="5" y1="40" x2="35" y2="40" stroke="#808080" stroke-width="1"/>
      <line x1="5" y1="60" x2="35" y2="60" stroke="#808080" stroke-width="1"/>
      <line x1="5" y1="80" x2="35" y2="80" stroke="#808080" stroke-width="1"/>
    </svg>
  </div>

  <!-- Farmhouse -->
  <div class="farmhouse">
    <svg viewBox="0 0 80 70" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M40 5 L75 30 L75 65 L5 65 L5 30 Z" fill="#F5DEB3"/>
      <path d="M40 5 L75 30 L5 30 Z" fill="#DEB887"/>
      <rect x="25" y="35" width="30" height="30" fill="#8B4513" stroke="#5D3A1A" stroke-width="2"/>
      <circle cx="40" cy="50" r="2" fill="#FFD700"/>
      <rect x="15" y="20" width="12" height="15" fill="#87CEEB" stroke="#5D3A1A" stroke-width="1"/>
      <rect x="53" y="20" width="12" height="15" fill="#87CEEB" stroke="#5D3A1A" stroke-width="1"/>
    </svg>
  </div>

  <!-- Hay bales -->
  <div class="hay hay-1">
    <svg viewBox="0 0 50 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="25" cy="22" rx="23" ry="12" fill="#DAA520"/>
      <ellipse cx="25" cy="18" rx="21" ry="10" fill="#FFD700"/>
      <line x1="8" y1="18" x2="8" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="25" y1="12" x2="25" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="42" y1="18" x2="42" y2="28" stroke="#8B4513" stroke-width="2"/>
    </svg>
  </div>
  <div class="hay hay-2">
    <svg viewBox="0 0 50 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="25" cy="22" rx="23" ry="12" fill="#DAA520"/>
      <ellipse cx="25" cy="18" rx="21" ry="10" fill="#FFD700"/>
      <line x1="8" y1="18" x2="8" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="25" y1="12" x2="25" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="42" y1="18" x2="42" y2="28" stroke="#8B4513" stroke-width="2"/>
    </svg>
  </div>
  <div class="hay hay-3">
    <svg viewBox="0 0 50 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="25" cy="22" rx="23" ry="12" fill="#DAA520"/>
      <ellipse cx="25" cy="18" rx="21" ry="10" fill="#FFD700"/>
      <line x1="8" y1="18" x2="8" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="25" y1="12" x2="25" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="42" y1="18" x2="42" y2="28" stroke="#8B4513" stroke-width="2"/>
    </svg>
  </div>
  <div class="hay hay-4">
    <svg viewBox="0 0 50 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="25" cy="22" rx="23" ry="12" fill="#DAA520"/>
      <ellipse cx="25" cy="18" rx="21" ry="10" fill="#FFD700"/>
      <line x1="8" y1="18" x2="8" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="25" y1="12" x2="25" y2="28" stroke="#8B4513" stroke-width="2"/>
      <line x1="42" y1="18" x2="42" y2="28" stroke="#8B4513" stroke-width="2"/>
    </svg>
  </div>

  <div class="game-container">
    <div class="header">
      <div class="title">WHACK-A-BULK!</div>
      <div class="stats">
        <div class="stat score">üí• <span id="score">0</span></div>
        <div class="stat time">‚è±Ô∏è <span id="time">30</span></div>
        <div class="stat high">üèÜ <span id="highScore">0</span></div>
      </div>
    </div>

    <div class="game-area" id="gameArea"></div>
  </div>

  <div class="ground"></div>
  <div class="fence"></div>

  <!-- Start Screen -->
  <div class="start-screen" id="startScreen">
    <div class="screen-title">WHACK-A-BULK!</div>
    <div class="screen-subtitle">üåæ FARM EDITION üåæ</div>
    
    <div class="instructions">
      <p>üëä Whack the angry Bulk as fast as you can!</p>
      <p>‚è±Ô∏è You have 30 seconds</p>
      <p>üèÜ Beat your high score!</p>
    </div>
    
    <button class="btn" onclick="startGame()">PLAY!</button>
  </div>

  <!-- Game Over Screen -->
  <div class="game-over-screen hidden" id="gameOverScreen">
    <div class="screen-title">TIME'S UP!</div>
    <div class="final-score" id="finalScore">0</div>
    <div class="new-high hidden" id="newHigh">üåü NEW RECORD! üåü</div>
    <button class="btn" onclick="showStartScreen()">PLAY AGAIN</button>
  </div>

  <script>
    // Only angry sprites!
    const ALL_SPRITES = [
      'https://bulked.lol/images/gachi-s/baby-angry.png',
      'https://bulked.lol/images/gachi-s/bulk-angry.png',
      'https://bulked.lol/images/gachi-s/elder-angry.png',
    ];

    let score = 0;
    let timeLeft = 30;
    let highScore = parseInt(localStorage.getItem('whackABulkHigh') || '0');
    let gameInterval = null;
    let spawnTimeout = null;
    let isPlaying = false;
    let difficulty = 1200;
    let lastHole = -1;
    let combo = 0;
    let lastWhackTime = 0;

    // Initialize
    document.getElementById('highScore').textContent = highScore;
    createHoles();

    function createHoles() {
      const gameArea = document.getElementById('gameArea');
      for (let i = 0; i < 9; i++) {
        const hole = document.createElement('div');
        hole.className = 'hole';
        hole.dataset.index = i;
        
        const bulk = document.createElement('div');
        bulk.className = 'bulk';
        
        hole.appendChild(bulk);
        hole.addEventListener('click', (e) => whack(hole, e));
        hole.addEventListener('touchstart', (e) => {
          e.preventDefault();
          whack(hole, e);
        });
        
        gameArea.appendChild(hole);
      }
    }

    function setupDifficulty() {
      document.querySelectorAll('.diff-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          difficulty = parseInt(btn.dataset.speed);
        });
      });
    }

      // Random sprite from angry list
      score = 0;
      timeLeft = 30;
      isPlaying = true;
      combo = 0;
      
      document.getElementById('score').textContent = score;
      document.getElementById('time').textContent = timeLeft;
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameOverScreen').classList.add('hidden');
      
      // Start timer
      gameInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('time').textContent = timeLeft;
        
        // Time warning
        if (timeLeft <= 5) {
          document.getElementById('time').parentElement.style.animation = 'scorePulse 0.3s ease-in-out infinite';
        } else {
          document.getElementById('time').parentElement.style.animation = '';
        }
        
        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
      
      // Start spawning
      spawnBulk();
    }

    function spawnBulk() {
      if (!isPlaying) return;
      
      const holes = document.querySelectorAll('.hole');
      let index;
      
      do {
        index = Math.floor(Math.random() * holes.length);
      } while (index === lastHole);
      
      lastHole = index;
      const hole = holes[index];
      
      // Random sprite
      const sprite = ALL_SPRITES[Math.floor(Math.random() * ALL_SPRITES.length)];
      hole.querySelector('.bulk').style.backgroundImage = `url(${sprite})`;
      
      // Pop up animation
      hole.classList.add('up');
      
      // Random stay time based on difficulty
      const minTime = difficulty * 0.6;
      const maxTime = difficulty * 1.2;
      const stayTime = minTime + Math.random() * (maxTime - minTime);
      
      spawnTimeout = setTimeout(() => {
        if (hole.classList.contains('up') && !hole.classList.contains('whacked')) {
          hole.classList.remove('up');
        }
        if (isPlaying) spawnBulk();
      }, stayTime);
    }

    function whack(hole, event) {
      if (!isPlaying) return;
      if (!hole.classList.contains('up')) return;
      if (hole.classList.contains('whacked')) return;
      
      // Combo system
      const now = Date.now();
      if (now - lastWhackTime < 500) {
        combo++;
        if (combo >= 3) {
          showCombo(combo);
        }
      } else {
        combo = 1;
      }
      lastWhackTime = now;
      
      // Calculate score with combo bonus
      const points = 1 + Math.floor(combo / 3);
      score += points;
      document.getElementById('score').textContent = score;
      
      // Visual feedback
      hole.classList.add('whacked');
      setTimeout(() => {
        hole.classList.remove('up', 'whacked');
      }, 150);
      
      // Show score popup
      const popup = document.createElement('div');
      popup.className = 'score-popup';
      popup.textContent = combo >= 3 ? `+${points} x${combo}!` : '+1';
      popup.style.left = hole.offsetLeft + hole.offsetWidth / 2 + 'px';
      popup.style.top = hole.offsetTop + 'px';
      document.body.appendChild(popup);
      setTimeout(() => popup.remove(), 600);
      
      // Create dirt particles
      createDirt(hole);
      
      // Speed up next spawn slightly
      clearTimeout(spawnTimeout);
      spawnBulk();
    }

    function createDirt(hole) {
      const rect = hole.getBoundingClientRect();
      for (let i = 0; i < 6; i++) {
        const dirt = document.createElement('div');
        dirt.className = 'dirt';
        dirt.style.left = rect.left + rect.width / 2 + 'px';
        dirt.style.top = rect.top + rect.height / 2 + 'px';
        dirt.style.setProperty('--dx', (Math.random() - 0.5) * 60 + 'px');
        dirt.style.setProperty('--dy', -Math.random() * 40 - 10 + 'px');
        document.body.appendChild(dirt);
        setTimeout(() => dirt.remove(), 400);
      }
    }

    function showCombo(count) {
      const comboEl = document.createElement('div');
      comboEl.className = 'combo';
      comboEl.textContent = `${count}x COMBO!`;
      document.body.appendChild(comboEl);
      setTimeout(() => comboEl.remove(), 500);
    }

    function endGame() {
      isPlaying = false;
      clearInterval(gameInterval);
      clearTimeout(spawnTimeout);
      
      document.querySelectorAll('.hole').forEach(h => h.classList.remove('up'));
      
      document.getElementById('finalScore').textContent = score;
      document.getElementById('time').parentElement.style.animation = '';
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('whackABulkHigh', highScore);
        document.getElementById('highScore').textContent = highScore;
        document.getElementById('newHigh').classList.remove('hidden');
      } else {
        document.getElementById('newHigh').classList.add('hidden');
      }
      
      document.getElementById('gameOverScreen').classList.remove('hidden');
      
      // Submit to play.fun
      if (typeof window.sdk !== 'undefined' && window.sdk.savePoints) {
        window.sdk.savePoints({ points: score }).then(() => {
          console.log('‚úÖ Score submitted:', score);
        }).catch(err => console.error('Score submit failed:', err));
      }
    }

    function showStartScreen() {
      document.getElementById('gameOverScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    }

    // Play.fun SDK
    window.sdk = new OpenGameSDK({ ui: { usePointsWidget: true } });
    window.sdk.init({ gameId: 'whack-a-bulk' }).then(() => {
      console.log('Play.fun SDK ready');
    }).catch(err => console.error('SDK init failed:', err));
  </script>
</body>
</html>
